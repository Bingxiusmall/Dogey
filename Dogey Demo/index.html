<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<link rel="stylesheet" href="https://pyscript.net/alpha/pyscript.css" />
		<script defer src="https://pyscript.net/alpha/pyscript.js"></script>
		<script>
			function copy(){
				var element = document.getElementById('clicktocopy');
				element.style.display = 'block';
				element.select();
				document.execCommand("Copy");
				element.style.display = 'none';
				window.alert("Copy successfully");
			}
			function addCookie(){
				var element = document.getElementById('Dogey input');
				value = element.value;
				element = document.getElementById('filenameinput');
				name = element.value;
				if(name == "")
					window.alert("Please write filename :(");
				else if(name.indexOf("=") != -1)
					window.alert("Filename can't have '=' :(");
				else if(name.indexOf(";") != -1)
					window.alert("Filename can't have ';' :(");
				else{
					document.cookie = name + "=" + value;
					hidefileinput();
					window.alert("Project saved");
				}
			}
			function filename(){
				var element = document.getElementById('filenameinput');
				element.style.display = 'block';
				element = document.getElementById('clicktosave');
				element.style.display = 'block';
			}
			function hidefileinput(){
				var element = document.getElementById('filenameinput');
				element.style.display = 'none';
				element = document.getElementById('clicktosave');
				element.style.display = 'none';
			}
			function getCookieList(){
				if (document.cookie == '')
					return {};
				return document.cookie.split('; ');
			}
			function readfile(){
				var element = document.getElementById('readfilename');
				element.style.display = 'block';
				element = document.getElementById('clicktoread');
				element.style.display = 'block';
			}
			function readcookie(filename){
				var Cookielist = getCookieList();
				var cookielen = Cookielist.length;
				for(var i=0;i<cookielen;i++){
					var cookie = Cookielist[i].split('=');
					if(cookie[0] == filename)
						return cookie[1];
				}
				return undefined;
			}
			function hidereadingfile(){
				var element = document.getElementById('readfilename');
				element.style.display = 'none';
				element = document.getElementById('clicktoread');
				element.style.display = 'none';
			}
			function readfileincookie(){
				var element = document.getElementById('readfilename');
				var filename = element.value;
				file = readcookie(filename);
				if(file == undefined)
					window.alert('There\'s no file named [' + filename + '], please try another one');
				else{
					element = document.getElementById('Dogey input');
					element.value = file;
					element = document.getElementById('filenameinput');
					element.value = filename;
					hidereadingfile();
					window.alert('Reading successfully');
				}
			}
		</script>
		<style>
			body {
				padding: 20px 20px;
				font-family: Menlo, Monaco, Consolas, "Andale Mono", "Ubuntu Mono", "Courier New", monospace;
			}
			.container {
				width: 100%;
				position: relative;
				font-size: 14px;
				line-height: 15px;
			}
			.container div {         
				visibility: hidden;
				padding: 100px 0px;
			}
			.container textarea {
				width: 100%;
				height: 100%;
				position: absolute;
				top: 0px;
				padding: 0px;
				box-sizing: content-box;
			}
		</style>
		<py-env>
			- re
			- selenium
		</py-env>
	</head>
	<body>
		<h3>
Welcome to Dogey Program Communication.<br>
Do your Dogey Project now.<br>
try to use:<br>
<code style="user-select:none;width:100%;height:200px;color: blue;">
doge  doge  DOGE   doge  doge doge doge doge  DOGE   doge doge doge      doge   doge  doge doge doge doge  DOGE   doge doge          DOGE   doge  doge  doge doge   doge doge doge  DOGE   doge  doge  doge   doge  doge  doge   doge doge      DOGE   doge doge  doge  doge  DOGE   doge  doge doge doge doge  DOGE   doge          DOGE   doge doge      DOGE   doge doge  doge doge   doge  doge  doge   doge doge  doge   doge  doge doge doge doge doge   doge doge          DOGE<br>
doge doge    doge   doge doge  doge doge   doge    doge  DOGE   doge  doge doge doge   doge doge doge  doge   doge doge    doge doge  DOGE   doge  doge  DOGE   doge doge    doge doge doge</code>
<textarea id="clicktocopy" style="display:none;">
doge  doge  DOGE   doge  doge doge doge doge  DOGE   doge doge doge      doge   doge  doge doge doge doge  DOGE   doge doge          DOGE   doge  doge  doge doge   doge doge doge  DOGE   doge  doge  doge   doge  doge  doge   doge doge      DOGE   doge doge  doge  doge  DOGE   doge  doge doge doge doge  DOGE   doge          DOGE   doge doge      DOGE   doge doge  doge doge   doge  doge  doge   doge doge  doge   doge  doge doge doge doge doge   doge doge          DOGE
doge doge    doge   doge doge  doge doge   doge    doge  DOGE   doge  doge doge doge   doge doge doge  doge   doge doge    doge doge  DOGE   doge  doge  DOGE   doge doge    doge doge doge</textarea>
<br>
<button onclick="copy();" style="color: red;">click to copy</button>
<br>
to print 'Hello, world!' :)
		</h3>
		<button id='run' style="color: red;">click to run</button>
		<br>
		<button id='save' style="color: green;" onclick="filename();">click to save(to Cookie)</button>
		<input id='filenameinput' style="display:none;" placeholder="write filename here"></input>
		<button id='clicktosave' style="color: green;display:none;" onclick="addCookie()">save project</button>
		<br>
		<button id='read' style="color: green;" onclick="readfile();">click to read file(in Cookie)</button>
		<input id='readfilename' style="display:none;" placeholder="write filename here"></input>
		<button id='clicktoread' style="color: green;display:none;" onclick="readfileincookie()">read project</button>
		<br>
		<h3>
main.dogey
		</h3>
		<div class="container">	
			<div></div>
			<textarea id="Dogey input" style="width:100%;">
doge  doge  DOGE   doge  doge doge doge doge  DOGE   doge doge doge      doge   doge  doge doge doge doge  DOGE   doge doge          DOGE   doge  doge  doge doge   doge doge doge  DOGE   doge  doge  doge   doge  doge  doge   doge doge      DOGE   doge doge  doge  doge  DOGE   doge  doge doge doge doge  DOGE   doge          DOGE   doge doge      DOGE   doge doge  doge doge   doge  doge  doge   doge doge  doge   doge  doge doge doge doge doge   doge doge          DOGE
doge doge    doge   doge doge  doge doge   doge    doge  DOGE   doge  doge doge doge   doge doge doge  doge   doge doge    doge doge  DOGE   doge  doge  DOGE   doge doge    doge doge doge</textarea>
		</div>
		<h3>
output
		</h3>
		<code id='output' style="width:100%;"></code>
		<button id='format'></button>
		<script>
			const textarea = document.querySelector('.container textarea');
			const div = document.querySelector('.container div');
			textarea.addEventListener('input', (e) => {
				div.innerText = e.target.value;
			});
		</script>
		<script>
			function to_br(text) {
				return text.replace(/\n|\r/g, '<br>');
			}
			const button = document.getElementById('format');
			const outputarea = document.getElementById('output');
			button.addEventListener('click', (q) => {
				outputarea.innerHTML = to_br(outputarea.innerHTML);
			});
		</script>
		<py-script>
import re
import pyodide


class NotDoge:
    def __getitem__(self, item):
        return True


def encode_chr(s):  #
    if 0 <= s <= 9:
        return chr(s + 48)  # 48 ~ 57  0 ~ 9
    elif 10 <= s <= 35:
        return chr(s + 87)  # 97 ~ 122  a ~ z
    elif 36 <= s <= 61:
        return chr(s + 29)  # 65 ~ 90  A ~ Z
    elif 62 <= s <= 109:
        return chr(s - 62)  # 0 ~ 47  0x00(Null) ~ 0x2F(/)
    elif 110 <= s <= 116:
        return chr(s - 52)  # 58 ~ 64  0x3A(:) ~ 0x40(@)
    elif 117 <= s <= 122:
        return chr(s - 26)  # 91 ~ 96  0x5B([) ~ 0x60(`)
    else:
        return chr(s)  # other ascii characters


def split(s):
    result = []
    spliting = ""
    i = 0
    while i < len(s):
        if s[i:i + 4] == '   d' and s[i-1] != ' ':
            result.append(spliting)
            spliting = ""
            i += 3
        else:
            spliting += s[i]
            i += 1
    result.append(spliting)
    return result


def encoding(s):
    result = ""
    for i in re.split('\n', s):
        if i == '':
            pass
        else:
            for letter in split(i):
                if letter in ['  ', 'dOGE  ', 'dOGE  DOGE', '  DOGE']:
                    result += "1"
                else:
                    encoding_num = 0
                    encoding_split = re.split(' {2}', letter)
                    for j in range(len(encoding_split)):
                        for k in re.split(' ', encoding_split[j]):
                            if k == 'doge':
                                encoding_num <<= 1
                                encoding_num += 1
                            elif k in ['DOGE', 'dOGE']:
                                pass
                            else:
                                if k != '':
                                    return NotDoge()
                        if j != len(encoding_split) - 1:
                            encoding_num <<= 1
                    result += encode_chr(encoding_num)
        result += '\n'
    return result


def print_result(text):
    global result_text
    result_text += text + '\n'


def print(text):
    print_result(text)


def run_py(text):
    global result_text
    encoding_string = text
    result_text = ""
    encoded_result = encoding(encoding_string)
    print('====================[Dogey encoded result]====================')
    if type(encoded_result[0]) == bool:
        print('||              [Errno 0x00000001] Not Doge!!!              ||')
    else:
        print(encoded_result)
    print('==============================================================')
    if type(encoded_result[0]) == str:
        print('')
        print('====================[Dogey running console]====================')
        try:
            exec(encoded_result)
        except Exception as e:
            print('[Errno 0x00000002] Runtime Error: ' + str(e))
        print('===============================================================')
    return result_text


def to_nbsp(text):
	return re.sub(' ', '&nbsp;', text)


def to_br(text):
	return re.sub('\n', '\\n', text)


def on_click(e):
	element = document.getElementById('run')
	element.innerHTML = 'Please wait...'
	element = document.getElementById('Dogey input')
	value = element.value
	element = document.getElementById('output')
	element.innerHTML = 'Please wait for response...'
	py_result = run_py(value)
	element.innerHTML = to_nbsp(to_br(py_result))
	element = document.getElementById('run')
	element.innerHTML = 'click to run'
	element = document.getElementById('format')
	element.click()


result_text = ""
element = document.getElementById('run')
element.addEventListener('click', pyodide.create_proxy(on_click))

		</py-script>
	</body>
</html>
